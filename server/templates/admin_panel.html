{% extends "base.html" %}

{% block title %} Admin Panel - Hyperindex{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', path='admin.css') }}">
  <style>
    .tabs-nav { display: flex; gap: 1rem; margin-bottom: 1rem; }
    .tabs-nav button {
      padding: 0.5rem 1rem;
      font-weight: bold;
      border: none;
      background: #ddd;
      cursor: pointer;
    }
    .tabs-nav button.active {
      background: #bbb;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>
{% endblock %}

{% block body_class %}theme-admin{% endblock %}

{% block content %}
  <h1>Admin Panel</h1>
  <p>Welcome, {{ user.username }}!</p>

  <div class="tabs-nav">
    <button type="button" class="tab-btn active" data-tab="pending">Pending Submissions</button>
    <button type="button" class="tab-btn" data-tab="public">Public Entries</button>
    <button type="button" class="tab-btn" data-tab="deleted">Deleted Entries</button>
  </div>

  <section id="tab-pending" class="tab-content active" aria-labelledby="pending-heading">
    <h2 id="pending-heading">Pending Submissions</h2>
    {% for entry in pending_entries %}
      {% set show_admin_actions = True %}
      {% include "partials/entry_card.html" with context %}
    {% else %}
      <p>No entries pending review.</p>
    {% endfor %}

    {% set page = page_pending %}
    {% set total_pages = total_pages_pending %}
    {% set base_url = '/admin?page_public=' ~ page_public ~ '&page_pending=' %}
    {% set has_prev = page_pending > 1 %}
    {% set has_next = page_pending < total_pages_pending %}
    {% include "partials/pagination.html" %}
  </section>

  <section id="tab-public" class="tab-content" aria-labelledby="public-heading">
    <h2 id="public-heading">Public Entries (Yellowpages)</h2>
    {% for entry in public_entries %}
      {% set show_admin_actions = True %}
      {% include "partials/entry_card.html" with context %}
    {% else %}
      <p>No public entries.</p>
    {% endfor %}

    {% set page = page_public %}
    {% set total_pages = total_pages_public %}
    {% set base_url = '/admin?page_pending=' ~ page_pending ~ '&page_public=' %}
    {% set has_prev = page_public > 1 %}
    {% set has_next = page_public < total_pages_public %}
    {% include "partials/pagination.html" %}
  </section>

<section id="tab-deleted" class="tab-content" aria-labelledby="deleted-heading">
  <h2 id="deleted-heading">Deleted Entries</h2>
  {% for entry in deleted_entries %}
    {% set show_admin_actions = True %}
    {% set page_pending = page_pending %}
    {% set page_public = page_public %}
    {% set page_deleted = page_deleted %}
    {% include "partials/entry_card.html" with context %}
  {% else %}
    <p>No deleted entries.</p>
  {% endfor %}

  {% set page = page_deleted %}
  {% set total_pages = total_pages_deleted %}
  {% set has_prev = page_deleted > 1 %}
  {% set has_next = page_deleted < total_pages_deleted %}
  {% set base_url = '/admin?page_pending=' ~ page_pending ~ '&page_public=' ~ page_public ~ '&page_deleted=' %}
  {% include "partials/pagination.html" %}
</section>


  <script>
    const buttons = document.querySelectorAll('.tab-btn');
    const tabs = document.querySelectorAll('.tab-content');

    function switchTo(tab) {
      buttons.forEach(b => b.classList.remove('active'));
      tabs.forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
      document.getElementById(`tab-${tab}`).classList.add('active');
      window.location.hash = `tab-${tab}`;
    }

    buttons.forEach(btn => {
      btn.addEventListener('click', () => switchTo(btn.dataset.tab));
    });

    // Restore tab from URL hash on load
    const activeTab = window.location.hash?.replace('#tab-', '');
    if (activeTab && document.getElementById(`tab-${activeTab}`)) {
      switchTo(activeTab);
    }
  </script>
{% endblock %}