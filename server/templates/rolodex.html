<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rolodex - Hyperindex</title>
  <link rel="stylesheet" href="/static/rolodex.css">
</head>
<body>
  <div class="container" role="main">
    <h1>Welcome, {{ user.username }}</h1>

    <section aria-labelledby="add-entry-section">
      <h2 id="add-entry-section">Add a New Entry</h2>
      <p><a href="/entries/new">Go to entry form →</a></p>
    </section>

    <hr>

    <section aria-labelledby="your-entries-section">
      <h2 id="your-entries-section">Your Entries</h2>

      {% if selected_tag %}
        <p>Filtering by tag: <strong>{{ selected_tag }}</strong> —
          <a href="/rolodex">Clear Filter</a>
        </p>
      {% endif %}

      <p>Showing <strong>{{ entries|length }}</strong> of <strong>{{ total }}</strong> entries (page {{ page }} of {{ total_pages }})</p>

      {% for entry in entries %}
        <div class="card" data-label="Entry {{ loop.index }}">
          <h3><a href="{{ entry.url }}" target="_blank" rel="noopener noreferrer">{{ entry.title | e }}</a></h3>

          {% if entry.is_public_copy %}
            <span class="badge">Public</span>
          {% elif entry.submitted_to_public %}
            <span class="badge">Submitted</span>
          {% endif %}

          {% if entry.tags %}
            <div class="tags">
              {% for tag in entry.tags %}
                <span><a href="/rolodex?tag={{ tag.name }}">{{ tag.name }}</a></span>
              {% endfor %}
            </div>
          {% endif %}

          {% if entry.notes %}
            <p class="desc">{{ entry.notes | e }}</p>
          {% endif %}

          <div class="actions">
            <form method="GET" action="/entries/{{ entry.id }}/edit">
              <button type="submit">Edit</button>
            </form>

            <form method="POST" action="/entries/{{ entry.id }}/delete" onsubmit="return confirm('Are you sure you want to delete this entry?');">
              <button type="submit">Delete</button>
            </form>

            <form method="POST" action="/entries/{{ entry.id }}/submit">
              <button type="submit" {% if entry.submitted_to_public or entry.is_public_copy %}disabled{% endif %}>
                Submit to Yellowpages
              </button>
            </form>
          </div>
        </div>
      {% else %}
        <p>No entries yet.</p>
      {% endfor %}

      <div class="pagination" aria-label="Pagination navigation">
        {% if has_prev %}
          <a href="/rolodex?{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page={{ page - 1 }}" class="page-link" aria-label="Previous page">← Prev</a>
        {% endif %}

        {% if page == 1 %}
          <strong aria-current="page">1</strong>
        {% else %}
          <a href="/rolodex?{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page=1" class="page-link">1</a>
        {% endif %}

        {% if page > 4 %}
          <span class="page-ellipsis" aria-hidden="true">...</span>
        {% endif %}

        {% for p in range(page - 2, page + 3) %}
          {% if p > 1 and p < total_pages %}
            {% if p == page %}
              <strong aria-current="page">{{ p }}</strong>
            {% else %}
              <a href="/rolodex?{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page={{ p }}" class="page-link">{{ p }}</a>
            {% endif %}
          {% endif %}
        {% endfor %}

        {% if page < total_pages - 3 %}
          <span class="page-ellipsis" aria-hidden="true">...</span>
        {% endif %}

        {% if total_pages > 1 %}
          {% if page == total_pages %}
            <strong aria-current="page">{{ total_pages }}</strong>
          {% else %}
            <a href="/rolodex?{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page={{ total_pages }}" class="page-link">{{ total_pages }}</a>
          {% endif %}
        {% endif %}

        {% if has_next %}
          <a href="/rolodex?{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page={{ page + 1 }}" class="page-link" aria-label="Next page">Next →</a>
        {% endif %}
      </div>
    </section>
  </div>
</body>
</html>
