{% extends "base.html" %}

{% block title %}Rolodex - Hyperindex{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('static', path='rolodex.css') }}">
{% endblock %}

{% block body_class %}theme-rolodex{% endblock %}

{% block content %}
  <h1>Welcome, {{ user.username }}</h1>

  <section aria-labelledby="new-entry">
    <h2 id="new-entry">Add a New Entry</h2>
    <p><a href="/entries/new">Go to entry form →</a></p>
  </section>

  <hr>

  <section aria-labelledby="your-entries">
    <h2 id="your-entries">Your Entries</h2>
    <form method="get" action="/rolodex" style="margin-bottom: 1rem;">
      <input
        type="text"
        name="q"
        value="{{ query or '' }}"
        placeholder="Search your entries..."
        style="padding: 4px 6px; font-size: 0.85rem;"
      >
      {% if selected_tag %}
        <input type="hidden" name="tag" value="{{ selected_tag }}">
      {% endif %}
      <button type="submit" style="padding: 4px 10px; font-size: 0.85rem;">Search</button>
    </form>

    {% if selected_tag %}
      <p>
        Filtering by tag: <strong>{{ selected_tag }}</strong> —
        <a href="/rolodex">Clear Filter</a>
      </p>
    {% endif %}

    {% if query %}
      <p>
        Searching for: <strong>{{ query }}</strong>
        <a href="/rolodex{% if selected_tag %}?tag={{ selected_tag }}{% endif %}">Clear Search</a>
      </p>
    {% endif %}

    <p>
      Showing <strong>{{ entries|length }}</strong> of <strong>{{ total }}</strong> entries
      (page {{ page }} of {{ total_pages }})
    </p>

    {% for entry in entries %}
      {% set card_index = loop.index %}
      {% set tag_prefix = '/rolodex?tag=' %}
      {% set show_actions = True %}
      {% include "partials/entry_card.html" %}
    {% endfor %}

    {% include "partials/pagination.html" with context %}
  </section>
{% endblock %}